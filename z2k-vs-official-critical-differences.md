# –ö—Ä–∏—Ç–∏—á–Ω—ã–µ —Ä–∞–∑–ª–∏—á–∏—è: z2k vs –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π install_easy.sh

**–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞:** 2026-01-28
**–°—Ä–∞–≤–Ω–∏–≤–∞–µ–º—ã–µ —Ñ–∞–π–ª—ã:**
- `E:\Zapret2-keenetik\z2k.sh` + `E:\Zapret2-keenetik\lib\install.sh` (z2k)
- `E:\tmp\zapret2\install_easy.sh` (–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π —É—Å—Ç–∞–Ω–æ–≤—â–∏–∫)

---

## üî¥ –ö–†–ò–¢–ò–ß–ù–´–ï –£–ü–£–©–ï–ù–ò–Ø (–º–æ–≥—É—Ç –Ω–∞—Ä—É—à–∏—Ç—å —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å)

### 1. **–ù–ï –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è check_system() - –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –±–∞–∑–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ**

**–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥ (install_easy.sh:814):**
```bash
check_system        # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç: SYSTEM, SUBSYS, UNAME, INIT, SYSTEMCTL
check_source        # –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
```

**z2k –ø–æ–¥—Ö–æ–¥:**
```bash
# –í z2k.sh - –ù–ï–¢ –≤—ã–∑–æ–≤–∞ check_system()
# –í lib/install.sh - —Ç–æ–∂–µ –ù–ï–¢
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- ‚ùå **–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è `SYSTEM` –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤:
  - `common/installer.sh` —Ñ—É–Ω–∫—Ü–∏—è—Ö (check_readonly_system, service_stop_systemd –∏ —Ç.–¥.)
  - –£—Å–ª–æ–≤–∏—è—Ö –≤—ã–±–æ—Ä–∞ init —Å–∏—Å—Ç–µ–º—ã
- ‚ùå **–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è `UNAME` –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤:
  - `common/base.sh` (get_dir_inode, linux_min_version)
  - `common/installer.sh` (fix_perms: 398-404)
- ‚ùå **–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è `SUBSYS` –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è:
  - OpenWrt —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫
  - –í—ã–±–æ—Ä–∞ –º–µ–∂–¥—É fw3/fw4
- ‚ùå **–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è `INIT` –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞** - –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–∏–ø init —Å–∏—Å—Ç–µ–º—ã (systemd, procd –∏ —Ç.–¥.)

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å: üî¥ –í–´–°–û–ö–ê–Ø** - –±–µ–∑ —ç—Ç–∏—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏ common/ –Ω–µ –º–æ–≥—É—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å.

---

### 2. **–ù–ï –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è check_virt() - –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞**

**–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥ (install_easy.sh:612,640,678):**
```bash
check_virt    # –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–∏–ø –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç VIRT_*
```

**z2k –ø–æ–¥—Ö–æ–¥:**
```bash
# –ù–ï–¢ –≤—ã–∑–æ–≤–∞ check_virt()
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- ‚ö†Ô∏è –ù–µ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è —Ç–∏–ø –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏ (Docker, LXC, WSL –∏ —Ç.–¥.)
- ‚ö†Ô∏è –ú–æ–∂–µ—Ç –±—ã—Ç—å –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å: üü° –°–†–ï–î–ù–Ø–Ø** - –¥–ª—è Keenetic –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ (—Ñ–∏–∑–∏—á–µ—Å–∫–æ–µ –∂–µ–ª–µ–∑–æ), –Ω–æ –¥–ª—è Docker/WSL —É—Å—Ç–∞–Ω–æ–≤–æ–∫ –±—É–¥–µ—Ç –ø—Ä–æ–±–ª–µ–º–∞.

---

### 3. **–ù–ï –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è check_prerequisites_linux()**

**–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥ (install_easy.sh:643 –≤ install_sysv):**
```bash
check_prerequisites_linux    # –ü—Ä–æ–≤–µ—Ä—è–µ—Ç/—É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç: iptables, ipset, curl, nftables
```

**z2k –ø–æ–¥—Ö–æ–¥ (lib/install.sh:327):**
```bash
step_install_dependencies() {
    # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ runtime –±–∏–±–ª–∏–æ—Ç–µ–∫–∏:
    # libmnl, libnetfilter-queue, libnfnetlink, libcap, zlib, curl, unzip
    # ipset —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ
}
```

**–û—Ç–ª–∏—á–∏—è:**

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π | z2k | –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å |
|-----------|-------------|-----|-------------|
| **iptables** | ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è/—É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è | ‚ùå –ù–ï –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è | üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è iptables —Ä–µ–∂–∏–º–∞ |
| **ip6tables** | ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è/—É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è | ‚ùå –ù–ï –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è | ‚ö†Ô∏è –ö—Ä–∏—Ç–∏—á–Ω–æ –µ—Å–ª–∏ IPv6 –Ω–µ –æ—Ç–∫–ª—é—á–µ–Ω |
| **ipset** | ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è/—É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è | ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è (—Å—Ç—Ä–æ–∫–∞ 387) | ‚úÖ OK |
| **nftables (nft)** | ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è/—É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è | ‚ùå –ù–ï –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è | ‚ö†Ô∏è –ö—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è nftables —Ä–µ–∂–∏–º–∞ |
| **dnsutils** | ‚úÖ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è (apt-get) | ‚ùå –ù–ï —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è | ‚ö†Ô∏è –ù—É–∂–µ–Ω –¥–ª—è nslookup —Ç–µ—Å—Ç–æ–≤ |

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- ‚ùå –ù–∞ Keenetic iptables/ip6tables –≤—Å—Ç—Ä–æ–µ–Ω—ã –≤ —è–¥—Ä–æ ‚Üí OK
- ‚ùå –ù–æ –Ω–∞ –¥—Ä—É–≥–∏—Ö —Å–∏—Å—Ç–µ–º–∞—Ö (Entware –≤ Docker) –º–æ–∂–µ—Ç –Ω–µ –±—ã—Ç—å iptables ‚Üí FAIL
- ‚ùå nftables —Ä–µ–∂–∏–º –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤ z2k (–Ω–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏ nft)

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å: üî¥ –í–´–°–û–ö–ê–Ø –¥–ª—è –Ω–µ-Keenetic —Å–∏—Å—Ç–µ–º, üü¢ –ù–ò–ó–ö–ê–Ø –¥–ª—è Keenetic**

---

### 4. **–ù–ï –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è select_ipv6() - IPv6 –Ω–µ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ**

**–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥ (install_easy.sh:617,645 –∏ installer.sh:759):**
```bash
select_ipv6()    # –°–ø—Ä–∞—à–∏–≤–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: enable ipv6 support [Y/n]
                 # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç DISABLE_IPV6=0 –∏–ª–∏ DISABLE_IPV6=1
write_config_var DISABLE_IPV6
```

**z2k –ø–æ–¥—Ö–æ–¥:**
```bash
# –ù–ï–¢ select_ipv6()
# –í config —Ñ–∞–π–ª–µ –ø—Ä–æ—Å—Ç–æ:
DISABLE_IPV6=1    # Hardcoded
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- ‚ö†Ô∏è –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –º–æ–∂–µ—Ç –≤—ã–±—Ä–∞—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É IPv6
- ‚ö†Ô∏è –ï—Å–ª–∏ —É –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –µ—Å—Ç—å IPv6, –æ–±—Ö–æ–¥ –Ω–µ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –¥–ª—è IPv6 —Ç—Ä–∞—Ñ–∏–∫–∞
- ‚ö†Ô∏è ip6tables –ø—Ä–∞–≤–∏–ª–∞ –Ω–µ –±—É–¥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å—Å—è (`fw_nfqws_post6()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 0 –ø—Ä–∏ DISABLE_IPV6=1)

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å: üü° –°–†–ï–î–ù–Ø–Ø** - –≤ –†–æ—Å—Å–∏–∏ IPv6 —Ä–µ–¥–∫–æ—Å—Ç—å, –Ω–æ –¥–ª—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ –∫—Ä–∏—Ç–∏—á–Ω–æ.

---

### 5. **–ù–ï –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è select_fwtype() - FWTYPE –Ω–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º**

**–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥ (install_easy.sh:614,642 –∏ installer.sh:773):**
```bash
select_fwtype()    # –°–ø—Ä–∞—à–∏–≤–∞–µ—Ç: select firewall type: iptables | nftables
                   # –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞–µ—Ç –æ low RAM —Å–∏—Å—Ç–µ–º–∞—Ö –¥–ª—è nftables
write_config_var FWTYPE    # –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç –≤—ã–±–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```

**z2k –ø–æ–¥—Ö–æ–¥ (lib/install.sh:814):**
```bash
step_check_and_select_fwtype() {
    linux_fwtype    # –ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –±–µ–∑ –∑–∞–ø—Ä–æ—Å–∞
    # –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç –≤ config –ë–ï–ó –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
}
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- ‚ö†Ô∏è –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –≤—ã–±—Ä–∞—Ç—å iptables –Ω–∞ —Å–∏—Å—Ç–µ–º–µ —Å nftables
- ‚ö†Ô∏è –ù–µ—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ low RAM –¥–ª—è nftables
- ‚ö†Ô∏è –ù–∞ —Å–∏—Å—Ç–µ–º–∞—Ö —Å –æ–±–æ–∏–º–∏ firewall –º–æ–∂–µ—Ç –≤—ã–±—Ä–∞—Ç—å—Å—è –Ω–µ–æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å: üü° –°–†–ï–î–ù–Ø–Ø** - –∞–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ –±–µ–∑ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏.

---

### 6. **–ù–ï –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è ask_config() - –Ω–µ—Ç –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–µ–∂–∏–º–∞**

**–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥ (install_easy.sh:619,647 –∏ install_easy.sh:251):**
```bash
ask_config() {
    select_mode()          # –°–ø—Ä–∞—à–∏–≤–∞–µ—Ç: MODE_FILTER (none/ipset/hostlist/autohostlist)
    select_mode_mode()     # –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç nfqws –æ–ø—Ü–∏–∏
    select_mode_iface()    # –í—ã–±–∏—Ä–∞–µ—Ç LAN/WAN –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
    select_getlist()       # –°–ø—Ä–∞—à–∏–≤–∞–µ—Ç: auto download ip/host list
}
```

**z2k –ø–æ–¥—Ö–æ–¥:**
```bash
# –ù–ï–¢ ask_config()
# –í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–µ—Ä—É—Ç—Å—è –∏–∑ config —Ñ–∞–π–ª–∞ –ë–ï–ó –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- ‚ö†Ô∏è –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –º–æ–∂–µ—Ç –≤—ã–±—Ä–∞—Ç—å MODE_FILTER (–≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ—Ç, —á—Ç–æ –≤ config)
- ‚ö†Ô∏è –ù–µ —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç—Å—è –ø—Ä–æ auto download —Å–ø–∏—Å–∫–æ–≤ (GETLIST)
- ‚ö†Ô∏è –ù–µ –≤—ã–±–∏—Ä–∞—é—Ç—Å—è LAN/WAN –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã (–¥–ª—è flow offloading)
- ‚ö†Ô∏è –ù–µ –≤–∞–ª–∏–¥–∏—Ä—É—é—Ç—Å—è nfqws –æ–ø—Ü–∏–∏ —á–µ—Ä–µ–∑ `nfqws_opt_validate()`

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å: üü° –°–†–ï–î–ù–Ø–Ø** - –¥–ª—è Keenetic –º–æ–∂–Ω–æ –æ–±–æ–π—Ç–∏—Å—å –¥–µ—Ñ–æ–ª—Ç–Ω—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏, –Ω–æ –≥–∏–±–∫–æ—Å—Ç–∏ –Ω–µ—Ç.

---

### 7. **–ù–ï –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è ask_config_offload() - flow offloading –Ω–µ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è**

**–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥ (install_easy.sh:620,646 –∏ install_easy.sh:256):**
```bash
ask_config_offload() {
    echo "flow offloading can greatly increase speed on slow devices..."
    echo "select flow offloading: donttouch | none | software | hardware"
    ask_list FLOWOFFLOAD ...
    write_config_var FLOWOFFLOAD
}
```

**z2k –ø–æ–¥—Ö–æ–¥ (lib/install.sh:979):**
```bash
step_disable_hwnat_and_offload() {
    # –ü—Ä–æ—Å—Ç–æ –æ—Ç–∫–ª—é—á–∞–µ—Ç Hardware NAT –Ω–∞ Keenetic
    # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç FLOWOFFLOAD=none –ë–ï–ó –≤—ã–±–æ—Ä–∞
    export FLOWOFFLOAD=none
}
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- ‚ö†Ô∏è –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –º–æ–∂–µ—Ç –≤—ã–±—Ä–∞—Ç—å software/hardware offloading
- ‚ö†Ô∏è –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è FLOWOFFLOAD=none (–±–µ–∑–æ–ø–∞—Å–Ω–æ, –Ω–æ –Ω–µ –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ)
- ‚ö†Ô∏è –ù–∞ —Å–∏—Å—Ç–µ–º–∞—Ö —Å flow offloading –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –ø—Ä–∏—Ä–æ—Å—Ç —Å–∫–æ—Ä–æ—Å—Ç–∏, –Ω–æ z2k –Ω–µ –¥–∞—ë—Ç —ç—Ç–æ–≥–æ –≤—ã–±—Ä–∞—Ç—å

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å: üü° –°–†–ï–î–ù–Ø–Ø** - —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ –Ω–µ –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ.

---

### 8. **–ù–ï –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è ask_config_tmpdir() - tmpdir –Ω–µ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è**

**–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥ (install_easy.sh:766 –≤ install_openwrt –∏ install_easy.sh:283):**
```bash
ask_config_tmpdir() {
    # –î–ª—è low RAM —Å–∏—Å—Ç–µ–º –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å /opt/zapret2/tmp –≤–º–µ—Å—Ç–æ /tmp
    [ $(get_ram_mb) -le 400 ] && {
        echo "/tmp in openwrt is tmpfs. on low RAM systems not enough RAM"
        ask_list TMPDIR "/tmp $EXEDIR/tmp"
    }
}
```

**z2k –ø–æ–¥—Ö–æ–¥:**
```bash
# –ù–ï–¢ ask_config_tmpdir()
# TMPDIR –Ω–µ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- ‚ö†Ô∏è –ù–∞ —Ä–æ—É—Ç–µ—Ä–∞—Ö —Å –º–∞–ª—ã–º RAM (‚â§400MB) –∑–∞–≥—Ä—É–∑–∫–∞ –±–æ–ª—å—à–∏—Ö —Å–ø–∏—Å–∫–æ–≤ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ Out Of Memory
- ‚ö†Ô∏è /tmp –Ω–∞ OpenWrt/Keenetic —ç—Ç–æ tmpfs (50% RAM), –±–æ–ª—å—à–∏–µ —Ñ–∞–π–ª—ã –º–æ–≥—É—Ç –ø–µ—Ä–µ–ø–æ–ª–Ω–∏—Ç—å –ø–∞–º—è—Ç—å

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å: üü° –°–†–ï–î–ù–Ø–Ø –¥–ª—è low RAM —Å–∏—Å—Ç–µ–º** - –Ω–∞ Keenetic —Å 256MB RAM –∫—Ä–∏—Ç–∏—á–Ω–æ.

---

### 9. **–ù–ï –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è crontab_add() - –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–æ–≤ –Ω–µ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è**

**–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥ (install_easy.sh:651,653,688,776):**
```bash
crontab_del_quiet              # –£–¥–∞–ª—è–µ—Ç —Å—Ç–∞—Ä—ã–µ –∑–∞–ø–∏—Å–∏
crontab_add 10 22              # Desktop: –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤ 22:10
crontab_add 0 6                # Router: –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤ 06:00
cron_ensure_running            # –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —á—Ç–æ cron —Ä–∞–±–æ—Ç–∞–µ—Ç
```

**z2k –ø–æ–¥—Ö–æ–¥:**
```bash
# –ù–ï–¢ crontab_add()
# –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–æ–≤ –¥–æ–º–µ–Ω–æ–≤ –Ω–µ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- ‚ùå –°–ø–∏—Å–∫–∏ –¥–æ–º–µ–Ω–æ–≤ –Ω–µ –±—É–¥—É—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è—Ç—å—Å—è
- ‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –≤—Ä—É—á–Ω—É—é –∑–∞–ø—É—Å–∫–∞—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
- ‚ùå –ù–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –Ω–æ–≤—ã—Ö –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–æ–º–µ–Ω–æ–≤

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å: üî¥ –í–´–°–û–ö–ê–Ø** - —Å–ø–∏—Å–∫–∏ –¥–æ–º–µ–Ω–æ–≤ —É—Å—Ç–∞—Ä–µ–≤–∞—é—Ç, –Ω–æ–≤—ã–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –Ω–µ –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞—é—Ç—Å—è.

**–†–µ—à–µ–Ω–∏–µ –≤ z2k:** –ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å crontab –∑–∞–ø–∏—Å—å –≤ –º–µ–Ω—é –∏–ª–∏ –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ.

---

### 10. **–ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è dry_run_nfqws() - –≤–∞–ª–∏–¥–∞—Ü–∏—è –æ–ø—Ü–∏–π –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è**

**–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥ (install_easy.sh:197,787):**
```bash
nfqws_opt_validate() {
    ws_opt_validate "$1" || return 1     # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–ª–æ—Ö–∏—Ö –æ–ø—Ü–∏–π (--ipset)
    dry_run_nfqws || {                   # –¢–µ—Å—Ç –∑–∞–ø—É—Å–∫–∞ nfqws2 --dry-run
        echo "invalid nfqws2 options"
        return 1
    }
}
```

**z2k –ø–æ–¥—Ö–æ–¥:**
```bash
# –ù–ï–¢ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ --dry-run
# –û–ø—Ü–∏–∏ NFQWS2_OPT –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ config –ë–ï–ó –ø—Ä–æ–≤–µ—Ä–∫–∏
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- ‚ö†Ô∏è –ù–µ–≤–∞–ª–∏–¥–Ω—ã–µ –æ–ø—Ü–∏–∏ nfqws2 –±—É–¥—É—Ç –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Å–µ—Ä–≤–∏—Å–∞
- ‚ö†Ô∏è –ù–µ—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ–± –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –Ω–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã—Ö –æ–ø—Ü–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, --ipset –Ω–∞ Linux)
- ‚ö†Ô∏è –û—à–∏–±–∫–∏ –≤ Lua —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–µ –Ω–µ –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞—é—Ç—Å—è –Ω–∞ —ç—Ç–∞–ø–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å: üü° –°–†–ï–î–ù–Ø–Ø** - –ø—Ä–æ–±–ª–µ–º—ã –ø—Ä–æ—è–≤—è—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ.

---

## üü° –ù–ï–ö–†–ò–¢–ò–ß–ù–´–ï –†–ê–ó–õ–ò–ß–ò–Ø (–Ω–µ –Ω–∞—Ä—É—à–∞—é—Ç —Ä–∞–±–æ—Ç—É, –Ω–æ —É—Ö—É–¥—à–∞—é—Ç UX)

### 11. **–ù–ï –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è check_readonly_system()**

**–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥ (install_easy.sh:609,637 –∏ install_easy.sh:33):**
```bash
check_readonly_system() {
    # –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –¥–ª—è –∑–∞–ø–∏—Å–∏ init —Å–∏—Å—Ç–µ–º—ã
    [ -w "$SYSTEMD_SYSTEM_DIR" ] || RO=1
    [ -z "$RO" ] || {
        echo '!!! READONLY SYSTEM DETECTED !!!'
        ask_yes_no N "do you want to continue"
    }
}
```

**z2k –ø–æ–¥—Ö–æ–¥:**
```bash
# –ù–ï–¢ –ø—Ä–æ–≤–µ—Ä–∫–∏ readonly —Å–∏—Å—Ç–µ–º—ã
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- ‚ö†Ô∏è –ù–∞ readonly —Å–∏—Å—Ç–µ–º–∞—Ö (immutable OS) —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –º–æ–∂–µ—Ç —á–∞—Å—Ç–∏—á–Ω–æ –ø—Ä–æ–≤–∞–ª–∏—Ç—å—Å—è
- ‚ö†Ô∏è –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å: üü¢ –ù–ò–ó–ö–ê–Ø** - Keenetic –Ω–µ readonly —Å–∏—Å—Ç–µ–º–∞.

---

### 12. **–ù–ï –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è check_source()**

**–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥ (install_easy.sh:815 –∏ install_easy.sh:53):**
```bash
check_source() {
    # –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏
    [ -f "$EXEDIR/init.d/systemd/zapret2.service" ] || bad=1
    [ -f "$EXEDIR/init.d/openrc/zapret2" ] || bad=1
    [ "$bad" = 1 ] && {
        echo 'some critical files are missing'
        echo 'are you sure you are not using embedded release?'
        exitp 5
    }
}
```

**z2k –ø–æ–¥—Ö–æ–¥:**
```bash
# –ù–ï–¢ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞–ª–∏—á–∏—è –∏—Å—Ö–æ–¥–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
# z2k —Å–∫–∞—á–∏–≤–∞–µ—Ç –≤—Å—ë —Å GitHub, –ø–æ—ç—Ç–æ–º—É –Ω–µ –ø—Ä–∏–º–µ–Ω–∏–º–æ
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- ‚úÖ –î–ª—è z2k –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ - –≤—Å–µ —Ñ–∞–π–ª—ã —Å–∫–∞—á–∏–≤–∞—é—Ç—Å—è —Å GitHub
- ‚úÖ –ï—Å–ª–∏ GitHub –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–æ–≤–∞–ª–∏—Ç—Å—è –Ω–∞ —ç—Ç–∞–ø–µ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å: üü¢ –ù–ò–ó–ö–ê–Ø** - z2k –º–æ–¥–µ–ª—å –Ω–µ —Ç—Ä–µ–±—É–µ—Ç —ç—Ç–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏.

---

### 13. **–ù–ï –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è check_location() - —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –ù–ï –∏–∑ /opt/zapret2**

**–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥ (install_easy.sh:610,638 –∏ install_easy.sh:484):**
```bash
check_location() {
    # –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —á—Ç–æ —É—Å—Ç–∞–Ω–æ–≤—â–∏–∫ –∑–∞–ø—É—â–µ–Ω –∏–∑ /opt/zapret2
    # –ï—Å–ª–∏ –Ω–µ—Ç - –∫–æ–ø–∏—Ä—É–µ—Ç —Ç—É–¥–∞ –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç —Å–µ–±—è
    if [ $(get_dir_inode "$EXEDIR") != $(get_dir_inode "$ZAPRET_TARGET") ]; then
        echo "easy install is supported only from default location: $ZAPRET_TARGET"
        echo "currently its run from $EXEDIR"
        ask_yes_no N "do you want the installer to copy it for you"
        ...
        exec "$ZAPRET_TARGET/$(basename "$0")"
    fi
}
```

**z2k –ø–æ–¥—Ö–æ–¥:**
```bash
# z2k.sh —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–∑ /tmp/z2k/
# –í—Å–µ —Ñ–∞–π–ª—ã —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –≤ /opt/zapret2/
# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –∏–∑ /opt/zapret2/ –ù–ï –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- ‚úÖ z2k –º–æ–¥–µ–ª—å –ø—Ä–æ—â–µ - bootstrap —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–∑ /tmp, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –≤ /opt
- ‚úÖ –ù–µ —Ç—Ä–µ–±—É–µ—Ç –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ —Å–∫—Ä–∏–ø—Ç–∞

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å: üü¢ –ù–ò–ó–ö–ê–Ø** - z2k –º–æ–¥–µ–ª—å –ª—É—á—à–µ –¥–ª—è —Å–≤–æ–µ–≥–æ use case.

---

### 14. **–ù–ï –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è backup_restore_settings()**

**–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥ (install_easy.sh:477,508,520 –∏ install_easy.sh:447):**
```bash
backup_restore_settings 1    # Backup –ø–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º —Å—Ç–∞—Ä–æ–π –≤–µ—Ä—Å–∏–∏
_backup_settings "config" "init.d/sysv/custom.d" ...
# ... —É–¥–∞–ª–µ–Ω–∏–µ ...
backup_restore_settings 0    # Restore –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
```

**z2k –ø–æ–¥—Ö–æ–¥:**
```bash
# –ù–ï–¢ backup/restore –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏
# –ü—Ä–∏ –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–µ —Å—Ç–∞—Ä—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –º–æ–≥—É—Ç –±—ã—Ç—å –ø–æ—Ç–µ—Ä—è–Ω—ã
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- ‚ö†Ô∏è –ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ z2k –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π config –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞–Ω
- ‚ö†Ô∏è custom.d —Å–∫—Ä–∏–ø—Ç—ã –º–æ–≥—É—Ç –±—ã—Ç—å –ø–æ—Ç–µ—Ä—è–Ω—ã

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å: üü° –°–†–ï–î–ù–Ø–Ø** - –¥–ª—è production —É—Å—Ç–∞–Ω–æ–≤–æ–∫ –Ω—É–∂–µ–Ω –º–µ—Ö–∞–Ω–∏–∑–º backup.

**–†–µ—à–µ–Ω–∏–µ –≤ z2k:** –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ lib/config.sh (backup_config).

---

### 15. **–ù–ï –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è deoffload_openwrt_firewall()**

**–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥ (install_easy.sh:782 –≤ install_openwrt –∏ install_easy.sh:698):**
```bash
deoffload_openwrt_firewall() {
    # –ü—Ä–æ–≤–µ—Ä—è–µ—Ç firewall.@defaults[0].flow_offloading
    # –û—Ç–∫–ª—é—á–∞–µ—Ç –µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ –∏ nfqws –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
    fo=$(uci -q get firewall.@defaults[0].flow_offloading)
    [ "$fo" = "1" ] && {
        echo "system wide flow offloading detected. incompatible with nfqws. disabling"
        uci set firewall.@defaults[0].flow_offloading=0
        uci commit firewall
    }
}
```

**z2k –ø–æ–¥—Ö–æ–¥:**
```bash
# –ù–ï–¢ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è OpenWrt UCI firewall –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
# Keenetic –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç UCI
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- ‚úÖ –î–ª—è Keenetic –Ω–µ –ø—Ä–∏–º–µ–Ω–∏–º–æ (–Ω–µ—Ç UCI)
- ‚ö†Ô∏è –î–ª—è OpenWrt —É—Å—Ç–∞–Ω–æ–≤–æ–∫ z2k –Ω–µ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å: üü¢ –ù–ò–ó–ö–ê–Ø –¥–ª—è Keenetic, üî¥ –í–´–°–û–ö–ê–Ø –¥–ª—è OpenWrt**

---

### 16. **–ù–µ —Å–æ–∑–¥–∞—é—Ç—Å—è timer_install_systemd() –¥–ª—è –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è**

**–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥ (install_easy.sh:625 –∏ install_easy.sh:549):**
```bash
timer_install_systemd() {
    # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç systemd timer –¥–ª—è –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–ø–∏—Å–∫–æ–≤
    cp -f "$EXEDIR/init.d/systemd/zapret2-list-update.service" "$SYSTEMD_SYSTEM_DIR"
    cp -f "$EXEDIR/init.d/systemd/zapret2-list-update.timer" "$SYSTEMD_SYSTEM_DIR"
    systemctl enable zapret2-list-update.timer
    systemctl start zapret2-list-update.timer
}
```

**z2k –ø–æ–¥—Ö–æ–¥:**
```bash
# –ù–ï–¢ systemd timer
# Keenetic –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç systemd
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- ‚úÖ –î–ª—è Keenetic –Ω–µ –ø—Ä–∏–º–µ–Ω–∏–º–æ (–Ω–µ—Ç systemd)
- ‚ö†Ô∏è –î–ª—è systemd —Å–∏—Å—Ç–µ–º –Ω–µ—Ç –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ timer

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å: üü¢ –ù–ò–ó–ö–ê–Ø –¥–ª—è Keenetic**

---

### 17. **–ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è install_openwrt_iface_hook()**

**–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥ (install_easy.sh:778 –≤ install_openwrt):**
```bash
install_openwrt_iface_hook() {
    # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç hotplug —Å–∫—Ä–∏–ø—Ç /etc/hotplug.d/iface/90-zapret2
    # –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç firewall –ø—Ä–∞–≤–∏–ª–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤
}
```

**z2k –ø–æ–¥—Ö–æ–¥ (lib/install.sh:1567):**
```bash
step_install_netfilter_hook() {
    # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç Keenetic NDM hook: /opt/etc/ndm/netfilter.d/000-zapret2.sh
    # –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç –ø—Ä–∞–≤–∏–ª–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö –≤ netfilter
}
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- ‚úÖ z2k –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–≤–æ–π Keenetic-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–π hook (–ª—É—á—à–µ –¥–ª—è Keenetic)
- ‚úÖ OpenWrt hook –Ω–µ –Ω—É–∂–µ–Ω –¥–ª—è Keenetic

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å: üü¢ –ù–ò–ó–ö–ê–Ø** - z2k –ø–æ–¥—Ö–æ–¥ –ª—É—á—à–µ –¥–ª—è Keenetic.

---

### 18. **–ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è default_files() –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è user —Ñ–∞–π–ª–æ–≤**

**–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥ (install_easy.sh:349):**
```bash
default_files() {
    # –°–æ–∑–¥–∞—ë—Ç –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ user —Ñ–∞–π–ª—ã –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç:
    # - zapret-hosts-user-exclude.txt.default ‚Üí zapret-hosts-user-exclude.txt
    # - zapret-hosts-user.txt (–ø—É—Å—Ç–æ–π —Å nonexistent.domain)
    # - zapret-hosts-user-ipban.txt (–ø—É—Å—Ç–æ–π)
    # - init.d/*/custom.d/ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
}
```

**z2k –ø–æ–¥—Ö–æ–¥:**
```bash
# –ù–ï–¢ —Å–æ–∑–¥–∞–Ω–∏—è –¥–µ—Ñ–æ–ª—Ç–Ω—ã—Ö user —Ñ–∞–π–ª–æ–≤
# –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–∑–¥–∞–≤–∞—Ç—å –≤—Ä—É—á–Ω—É—é
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- ‚ö†Ô∏è –ù–µ—Ç template —Ñ–∞–π–ª–æ–≤ –¥–ª—è –∫–∞—Å—Ç–æ–º–Ω—ã—Ö —Å–ø–∏—Å–∫–æ–≤
- ‚ö†Ô∏è –ù–µ—Ç –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π custom.d –¥–ª—è –∫–∞—Å—Ç–æ–º–Ω—ã—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤
- ‚ö†Ô∏è –ú–µ–Ω–µ–µ —É–¥–æ–±–Ω–æ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å: üü° –°–†–ï–î–ù–Ø–Ø** - UX —É—Ö—É–¥—à–∞–µ—Ç—Å—è.

---

## üìä –°–í–û–î–ù–ê–Ø –¢–ê–ë–õ–ò–¶–ê –ö–†–ò–¢–ò–ß–ù–û–°–¢–ò

| # | –£–ø—É—â–µ–Ω–∏–µ | –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å | –ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è | –†–µ—à–µ–Ω–∏–µ |
|---|----------|-------------|-------------|---------|
| 1 | `check_system()` –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è | üî¥ –í–´–°–û–ö–ê–Ø | SYSTEM, UNAME, SUBSYS –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã ‚Üí common/ –º–æ–¥—É–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç | ‚úÖ **–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –¥–æ–±–∞–≤–∏—Ç—å** –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º common/ |
| 2 | `check_virt()` –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è | üü° –°–†–ï–î–ù–Ø–Ø | –î–ª—è Keenetic OK, –¥–ª—è Docker/WSL –ø—Ä–æ–±–ª–µ–º–∞ | ‚ö†Ô∏è –î–æ–±–∞–≤–∏—Ç—å –µ—Å–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è |
| 3 | `check_prerequisites_linux()` –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è | üî¥ –í–´–°–û–ö–ê–Ø | iptables/nftables –Ω–µ –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è (–¥–ª—è non-Keenetic) | ‚úÖ **–ö—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –Ω–µ-Keenetic —É—Å—Ç–∞–Ω–æ–≤–æ–∫** |
| 4 | `select_ipv6()` –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è | üü° –°–†–ï–î–ù–Ø–Ø | IPv6 hardcoded –æ—Ç–∫–ª—é—á–µ–Ω, –Ω–µ–ª—å–∑—è –≤–∫–ª—é—á–∏—Ç—å | ‚ö†Ô∏è –î–æ–±–∞–≤–∏—Ç—å –≤ –º–µ–Ω—é –æ–ø—Ü–∏—é |
| 5 | `select_fwtype()` –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è | üü° –°–†–ï–î–ù–Ø–Ø | –ù–µ—Ç –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞ firewall | ‚ö†Ô∏è –ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç |
| 6 | `ask_config()` –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è | üü° –°–†–ï–î–ù–Ø–Ø | –ù–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ MODE_FILTER, GETLIST | ‚ö†Ô∏è –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ –º–µ–Ω—é |
| 7 | `ask_config_offload()` –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è | üü° –°–†–ï–î–ù–Ø–Ø | FLOWOFFLOAD=none –≤—Å–µ–≥–¥–∞ (–Ω–µ –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ) | ‚ö†Ô∏è –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ –º–µ–Ω—é |
| 8 | `ask_config_tmpdir()` –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è | üü° –°–†–ï–î–ù–Ø–Ø | Low RAM —Å–∏—Å—Ç–µ–º—ã –º–æ–≥—É—Ç –ø–æ–ª—É—á–∏—Ç—å OOM | ‚ö†Ô∏è –ö—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è 256MB RAM —Ä–æ—É—Ç–µ—Ä–æ–≤ |
| 9 | `crontab_add()` –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è | üî¥ –í–´–°–û–ö–ê–Ø | **–°–ø–∏—Å–∫–∏ –Ω–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** | ‚úÖ **–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –¥–æ–±–∞–≤–∏—Ç—å** |
| 10 | `dry_run_nfqws()` –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è | üü° –°–†–ï–î–ù–Ø–Ø | –ù–µ–≤–∞–ª–∏–¥–Ω—ã–µ –æ–ø—Ü–∏–∏ –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞—é—Ç—Å—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ | ‚ö†Ô∏è –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é |
| 11 | `check_readonly_system()` –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è | üü¢ –ù–ò–ó–ö–ê–Ø | Keenetic –Ω–µ readonly | ‚úÖ OK |
| 12 | `check_source()` –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è | üü¢ –ù–ò–ó–ö–ê–Ø | z2k —Å–∫–∞—á–∏–≤–∞–µ—Ç —Å GitHub | ‚úÖ OK |
| 13 | `check_location()` –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è | üü¢ –ù–ò–ó–ö–ê–Ø | z2k –º–æ–¥–µ–ª—å –ª—É—á—à–µ | ‚úÖ OK |
| 14 | `backup_restore_settings()` –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è | üü° –°–†–ï–î–ù–Ø–Ø | –ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–µ—Ä—è—é—Ç—Å—è | ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ lib/config.sh |
| 15 | `deoffload_openwrt_firewall()` –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è | üü¢ –ù–ò–ó–ö–ê–Ø | Keenetic –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç UCI | ‚úÖ OK |
| 16 | `timer_install_systemd()` –Ω–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è | üü¢ –ù–ò–ó–ö–ê–Ø | Keenetic –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç systemd | ‚úÖ OK |
| 17 | `install_openwrt_iface_hook()` –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è | üü¢ –ù–ò–ó–ö–ê–Ø | z2k –∏—Å–ø–æ–ª—å–∑—É–µ—Ç NDM hook | ‚úÖ OK |
| 18 | `default_files()` –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è | üü° –°–†–ï–î–ù–Ø–Ø | –ù–µ—Ç template —Ñ–∞–π–ª–æ–≤ | ‚ö†Ô∏è –£—Ö—É–¥—à–∞–µ—Ç UX |

---

## üéØ –ü–†–ò–û–†–ò–¢–ï–¢–ù–´–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### 1. **–ö–†–ò–¢–ò–ß–ù–û** - –î–æ–±–∞–≤–∏—Ç—å `check_system()` –≤ z2k.sh

**–ú–µ—Å—Ç–æ –≤—Å—Ç–∞–≤–∫–∏:** –ü–æ—Å–ª–µ `source_modules()` –≤ z2k.sh:478

```bash
# –ó–∞–≥—Ä—É–∑–∏—Ç—å –º–æ–¥—É–ª–∏ –≤ –ø–∞–º—è—Ç—å
source_modules

# ‚úÖ –î–û–ë–ê–í–ò–¢–¨: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
echo "* Initializing system environment"
. "${ZAPRET2_DIR}/common/installer.sh"
check_system 1    # 1 = –Ω–µ –ø–∞–¥–∞—Ç—å –Ω–∞ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö

export SYSTEM SUBSYS UNAME INIT SYSTEMCTL
```

**–ó–∞—á–µ–º:**
- ‚úÖ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç SYSTEM, UNAME, SUBSYS
- ‚úÖ –ü–æ–∑–≤–æ–ª—è–µ—Ç common/ –º–æ–¥—É–ª—è–º –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å
- ‚úÖ –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–∏–ø init —Å–∏—Å—Ç–µ–º—ã

---

### 2. **–ö–†–ò–¢–ò–ß–ù–û** - –î–æ–±–∞–≤–∏—Ç—å `crontab_add()` –¥–ª—è –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–ø–∏—Å–∫–æ–≤

**–ú–µ—Å—Ç–æ –≤—Å—Ç–∞–≤–∫–∏:** –í –∫–æ–Ω—Ü–µ `step_finalize()` –≤ lib/install.sh:1727

```bash
# ‚úÖ –î–û–ë–ê–í–ò–¢–¨: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–ø–∏—Å–∫–æ–≤
print_info "–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–ø–∏—Å–∫–æ–≤ –¥–æ–º–µ–Ω–æ–≤..."

. "${ZAPRET2_DIR}/common/installer.sh"

# –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –∑–∞–ø–∏—Å–∏
crontab_del_quiet

# –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤ 06:00)
crontab_add 0 6

# –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ cron —Ä–∞–±–æ—Ç–∞–µ—Ç
cron_ensure_running

print_success "–ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–æ–≤ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ (–µ–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 06:00)"
```

---

### 3. **–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø** - –î–æ–±–∞–≤–∏—Ç—å `ask_config_tmpdir()` –¥–ª—è low RAM —Å–∏—Å—Ç–µ–º

**–ú–µ—Å—Ç–æ –≤—Å—Ç–∞–≤–∫–∏:** –í `run_full_install()` –ø–µ—Ä–µ–¥ `step_create_config_and_init()`

```bash
# ‚úÖ –î–û–ë–ê–í–ò–¢–¨: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ tmpdir –¥–ª—è low RAM —Å–∏—Å—Ç–µ–º
if [ $(get_ram_mb) -le 400 ]; then
    print_separator
    print_warning "–û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ —Å –º–∞–ª—ã–º –æ–±—ä—ë–º–æ–º RAM: $(get_ram_mb) MB"
    print_info "/tmp –Ω–∞ Keenetic —ç—Ç–æ tmpfs (–≤ –ø–∞–º—è—Ç–∏)"
    print_info "–ü—Ä–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–∏ –±–æ–ª—å—à–∏—Ö —Å–ø–∏—Å–∫–æ–≤ –º–æ–∂–µ—Ç –Ω–µ —Ö–≤–∞—Ç–∏—Ç—å –ø–∞–º—è—Ç–∏"

    printf "\n–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å /opt/zapret2/tmp –≤–º–µ—Å—Ç–æ /tmp? [Y/n]: "
    read -r answer </dev/tty

    case "$answer" in
        [Nn]|[Nn][Oo])
            TMPDIR=""
            ;;
        *)
            TMPDIR="/opt/zapret2/tmp"
            mkdir -p "$TMPDIR"
            print_success "TMPDIR —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ $TMPDIR"
            ;;
    esac

    write_config_var TMPDIR
fi
```

---

### 4. **–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø** - –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é —á–µ—Ä–µ–∑ `dry_run_nfqws()`

**–ú–µ—Å—Ç–æ –≤—Å—Ç–∞–≤–∫–∏:** –í `lib/strategies.sh` —Ñ—É–Ω–∫—Ü–∏–∏ `apply_strategy()`

```bash
# ‚úÖ –î–û–ë–ê–í–ò–¢–¨: –í–∞–ª–∏–¥–∞—Ü–∏—è –æ–ø—Ü–∏–π –ø–µ—Ä–µ–¥ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º
print_info "–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ –æ–ø—Ü–∏–π nfqws2..."

export NFQWS2_ENABLE=1
export NFQWS2_OPT="$tcp_opts"

. "${ZAPRET2_DIR}/common/installer.sh"

if dry_run_nfqws; then
    print_success "–û–ø—Ü–∏–∏ –≤–∞–ª–∏–¥–Ω—ã"
else
    print_error "–ù–µ–≤–∞–ª–∏–¥–Ω—ã–µ –æ–ø—Ü–∏–∏ nfqws2!"
    print_error "–°—Ç—Ä–∞—Ç–µ–≥–∏—è –Ω–µ –±—É–¥–µ—Ç –ø—Ä–∏–º–µ–Ω–µ–Ω–∞"
    return 1
fi
```

---

## üìù –í–´–í–û–î–´

### ‚úÖ –ß—Ç–æ z2k –¥–µ–ª–∞–µ—Ç –ü–†–ê–í–ò–õ–¨–ù–û (–ª—É—á—à–µ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ):

1. **Bootstrap –º–æ–¥–µ–ª—å** - —Å–∫–∞—á–∏–≤–∞–µ—Ç —Å–≤–µ–∂–∏–µ –º–æ–¥—É–ª–∏ —Å GitHub –≤–º–µ—Å—Ç–æ –ª–æ–∫–∞–ª—å–Ω—ã—Ö
2. **NDM hook –≤–º–µ—Å—Ç–æ hotplug** - –±–æ–ª–µ–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è Keenetic
3. **–£–ø—Ä–æ—â—ë–Ω–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞** - –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –≤—ã–±–æ—Ä–∞ –¥–µ—Å—è—Ç–∫–æ–≤ –æ–ø—Ü–∏–π
4. **Multi-profile –≥–µ–Ω–µ—Ä–∞—Ü–∏—è** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è TCP+UDP –ø—Ä–æ—Ñ–∏–ª–µ–π

### ‚ùå –ß—Ç–æ z2k –¥–µ–ª–∞–µ—Ç –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û (—Ö—É–∂–µ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ):

1. **–ù–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ** (SYSTEM, UNAME) ‚Üí –º–æ–¥—É–ª–∏ common/ –º–æ–≥—É—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å
2. **–ù–µ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–æ–≤** ‚Üí —Å–ø–∏—Å–∫–∏ —É—Å—Ç–∞—Ä–µ–≤–∞—é—Ç
3. **–ù–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç prerequisites** ‚Üí –º–æ–∂–µ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞ –Ω–µ-Keenetic —Å–∏—Å—Ç–µ–º–∞—Ö
4. **–ù–µ –¥–∞—ë—Ç –≤—ã–±–æ—Ä–∞ IPv6** ‚Üí –ø—Ä–æ–±–ª–µ–º—ã —É –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ —Å IPv6
5. **–ù–µ –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç tmpdir** ‚Üí OOM –Ω–∞ low RAM —Å–∏—Å—Ç–µ–º–∞—Ö

### üéØ –ì–ª–∞–≤–Ω—ã–π –≤—ã–≤–æ–¥:

**z2k —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ Keenetic, –ù–û:**
- –ù–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã—Ö –º–æ–¥—É–ª–µ–π common/
- –ú–æ–∂–µ—Ç —Å–ª–æ–º–∞—Ç—å—Å—è –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ zapret2 (–µ—Å–ª–∏ API –º–æ–¥—É–ª–µ–π –∏–∑–º–µ–Ω–∏—Ç—Å—è)
- –¢—Ä–µ–±—É–µ—Ç –ö–†–ò–¢–ò–ß–ù–´–• –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –¥–ª—è production –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
1. ‚úÖ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û: –î–æ–±–∞–≤–∏—Ç—å `check_system()` –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
2. ‚úÖ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û: –î–æ–±–∞–≤–∏—Ç—å `crontab_add()` –¥–ª—è –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–ø–∏—Å–∫–æ–≤
3. ‚ö†Ô∏è –†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø: –î–æ–±–∞–≤–∏—Ç—å `ask_config_tmpdir()` –¥–ª—è low RAM —Å–∏—Å—Ç–µ–º
4. ‚ö†Ô∏è –†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø: –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é —á–µ—Ä–µ–∑ `dry_run_nfqws()`

---

**–ö–æ–Ω–µ—Ü –∞–Ω–∞–ª–∏–∑–∞**
